<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Instructor Profile</title>
    <script type="module" src="/public/assets/js/instructor/instructor-profile.js">
    </script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>

<body class="bg-gray-100 flex">

  <!-- Sidebar -->
  <aside id="sidebar-placeholder" class="w-64 bg-white shadow-md"></aside>
  
  <!-- Main Content Wrapper -->
  <div class="flex-1 flex flex-col min-h-screen">
  
    <!-- Navbar -->
    <header class="bg-white shadow px-6 py-4 flex items-center justify-between">
      <div id="navbar-placeholder" class="w-full"></div>
    </header>

    <!-- Page Content -->
    <main x-data="instructorProfile()" x-init="init()" class="flex-1 p-6 max-w-6xl mx-auto w-full">

      <!-- Skeleton Loader -->
      <template x-if="loading">
        <div class="space-y-4 animate-pulse">
          <div class="h-16 w-16 bg-gray-300 rounded-full"></div>
          <div class="h-6 bg-gray-300 rounded w-1/3"></div>
          <div class="grid grid-cols-4 gap-4">
            <div class="h-24 bg-gray-300 rounded"></div>
            <div class="h-24 bg-gray-300 rounded"></div>
            <div class="h-24 bg-gray-300 rounded"></div>
            <div class="h-24 bg-gray-300 rounded"></div>
          </div>
        </div>
      </template>

      <!-- Profile Info -->
      <template x-if="!loading">
        <div>
          <div class="flex items-center space-x-4 bg-white p-4 rounded shadow">
            <img :src="`https://api.dicebear.com/6.x/initials/svg?seed=${instructor.fullName}`" alt="Avatar"
              class="w-24 h-24 rounded-full border shadow">
            <div>
              <h2 class="text-2xl font-bold" x-text="instructor.fullName"></h2>
              <p class="text-gray-600" x-text="instructor.email"></p>
              <p class="text-gray-500 text-sm">Joined: <span x-text="formatDate(instructor.dateCreated)"></span></p>
            </div>
            <div class="ml-auto">
              <button @click="openEditModal" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                Edit Profile
              </button>
            </div>
          </div>

          <!-- Overview Cards -->
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-6">
            <div class="bg-white p-4 rounded shadow">
              <div class="text-sm text-gray-500">ðŸ“˜ My Assessments</div>
              <div class="text-xl font-semibold" x-text="summary.totalAssessments || 0"></div>
            </div>
            <div class="bg-white p-4 rounded shadow">
              <div class="text-sm text-gray-500">ðŸŽ¯ Avg Score</div>
              <div class="text-xl font-semibold" x-text="(summary.avgScore || 0) + '%' "></div>
            </div>
            <div class="bg-white p-4 rounded shadow">
              <div class="text-sm text-gray-500">ðŸ“Š Pass Rate</div>
              <div class="text-xl font-semibold" x-text="(summary.passRate || 0) + '%' "></div>
            </div>
          </div>

          <!-- Assessments Table -->
          <div class="mt-8 bg-white shadow rounded p-4">
            <h3 class="text-lg font-bold mb-4">Assessments</h3>
            <div class="overflow-x-auto">
              <table class="w-full text-left border">
                <thead class="bg-gray-100">
                  <tr>
                    <th class="p-2">Title</th>
                    <th class="p-2">Technology</th>
                    <th class="p-2">Duration (mins)</th>
                    <th class="p-2">Start Date</th>
                    <th class="p-2">End Date</th>
                    <th class="p-2">Passing %</th>
                    <th class="p-2">Total Marks</th>
                  </tr>
                </thead>
                <tbody>
                  <template x-for="a in assessments" :key="a.id">
                    <tr class="border-t">
                      <td class="p-2" x-text="a.title"></td>
                      <td class="p-2" x-text="a.technologyStack"></td>
                      <td class="p-2" x-text="a.durationInMinutes"></td>
                      <td class="p-2" x-text="formatDate(a.startDate)"></td>
                      <td class="p-2" x-text="formatDate(a.endDate)"></td>
                      <td class="p-2" x-text="a.passingScore + '%'"></td>
                      <td class="p-2" x-text="a.totalMarks"></td>
                    </tr>
                  </template>
                  <tr x-if="assessments.length == 0">No Assessments found.</tr>
                </tbody>
              </table>
            </div>
          
            <!-- Pagination Controls -->
            <div class="flex justify-between items-center mt-4">
              <button @click="prevPage()" :disabled="!pagination.hasPreviousPage"
                class="px-3 py-1 bg-gray-200 rounded disabled:opacity-50">
                Previous
              </button>
              <span>Page <span x-text="pagination.currentPage"></span> of <span x-text="pagination.totalPages"></span></span>
              <button @click="nextPage()" :disabled="!pagination.hasNextPage"
                class="px-3 py-1 bg-gray-200 rounded disabled:opacity-50">
                Next
              </button>
            </div>
          </div>

        </div>
      </template>

      <!-- Edit Modal -->
      <!-- Profile Update Modal -->
      <div x-show="showEditModal" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
        x-transition>
        <div @click.away="closeEditModal" class="bg-white w-full max-w-md p-6 rounded-lg shadow-lg space-y-4">
          <h2 class="text-xl font-semibold">Update Profile</h2>
      
          <div>
            <label class="block text-sm font-medium">Full Name</label>
            <input type="text" class="w-full mt-1 border rounded px-3 py-2" x-model="editForm.name">
          </div>
      
          <div>
            <label class="block text-sm font-medium">Email</label>
            <input type="email" class="w-full mt-1 border rounded px-3 py-2" x-model="editForm.email">
          </div>
      
          <hr class="my-4">
      
          <h3 class="text-sm font-medium text-gray-600">Optional: Change Password</h3>
      
          <div>
            <label class="block text-sm font-medium">Current Password</label>
            <input type="password" class="w-full mt-1 border rounded px-3 py-2" x-model="editForm.currentPassword">
          </div>
      
          <div>
            <label class="block text-sm font-medium">New Password</label>
            <input type="password" class="w-full mt-1 border rounded px-3 py-2" x-model="editForm.newPassword">
          </div>
      
          <div class="flex justify-end space-x-2 pt-4">
            <button class="px-4 py-2 text-gray-600 hover:underline" @click="closeEditModal">Cancel</button>
            <button class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700" @click="submitUpdate">Save</button>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Alpine Component -->

</body>

</html>