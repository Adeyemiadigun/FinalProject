<!DOCTYPE html>
<html lang="en" x-data="viewSubmissionPage()" x-init="init()">

<head>
  <meta charset="UTF-8" />
  <title>View Submission</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module" src="/public/assets/js/shared/view-submission-answers.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <style>
    [x-cloak] {
      display: none;
    }
  </style>
</head>

<body class="bg-gray-100 text-gray-800">
  <div id="sidebar-placeholder"></div>

  <div class="md:ml-64 p-6 space-y-6">
    <div id="navbar-placeholder"></div>

    <!-- Loading Skeleton for Submission Details -->
    <div x-show="loading" class="space-y-4 animate-pulse" x-cloak>
      <div class="h-6 bg-gray-300 rounded w-1/3"></div>
      <div class="h-4 bg-gray-200 rounded w-1/2"></div>
      <div class="h-4 bg-gray-200 rounded w-1/4"></div>
      <div class="h-4 bg-gray-200 rounded w-1/3"></div>
      <div class="h-4 bg-gray-200 rounded w-1/4"></div>
    </div>

    <!-- Submission Details -->
    <div x-show="!loading" x-cloak>
      <h1 class="text-2xl font-bold mb-2">ğŸ“„ Submission Details</h1>
      <p class="text-gray-600">Assessment: <span x-text="submission.title"></span></p>
      <p class="text-gray-600">Student: <span x-text="submission.studentName"></span></p>
      <p class="text-gray-600">Submitted At: <span x-text="formatDate(submission.submittedAt)"></span></p>
      <p class="text-gray-600">Total Score: <span x-text="submission.totalScore + '%' "></span></p>
      <p class="text-gray-600">Feedback: <span x-text="submission.feedBack || 'N/A'"></span></p>
    </div>

    <!-- Loading Skeleton for Answers -->
    <div x-show="loading" class="bg-white rounded shadow p-4 animate-pulse space-y-4" x-cloak>
      <div class="h-5 bg-gray-300 rounded w-1/4"></div>
      <div class="space-y-2">
        <div class="h-4 bg-gray-200 rounded w-3/4"></div>
        <div class="h-4 bg-gray-200 rounded w-5/6"></div>
        <div class="h-4 bg-gray-200 rounded w-2/3"></div>
      </div>
    </div>

    <!-- Answers Section -->
    <div class="bg-white rounded shadow p-4" x-show="!loading" x-cloak>
      <h2 class="text-lg font-semibold mb-4">ğŸ“ Answers</h2>
      <template x-for="answer in submission.submittedAnswers" :key="answer.questionId">
        <div class="mb-6 border-l-4 border-blue-500 pl-4">
          <p class="font-bold mb-1" x-text="answer.order + '. ' + answer.questionText"></p>
          <p class="text-sm italic mb-1">Type: <span x-text="getTypeLabel(answer.questionType)"></span></p>

          <!-- MCQ -->
          <template x-if="answer.questionType === 1">
            <ul class="list-disc list-inside text-sm mb-2">
              <template x-for="opt in answer.options" :key="opt.optionText">
                <li>
                  <span x-text="opt.optionText"></span>
                  <span x-show="opt.isCorrect" class="text-green-600 font-semibold ml-2">(Correct)</span>
                  <span x-show="answer.selectedOptions.some(o => o.optionText === opt.optionText)"
                    class="text-blue-600 ml-2">(Selected)</span>
                </li>
              </template>
            </ul>
          </template>

          <!-- Objective -->
          <template x-if="answer.questionType === 2">
            <p class="text-sm"><strong>Answer:</strong> <span x-text="answer.submittedAnswer"></span></p>
          </template>

          <!-- Coding -->
          <template x-if="answer.questionType === 3">
            <div class="space-y-1 text-sm">
              <p><strong>Submitted Code:</strong></p>
              <pre class="bg-gray-100 p-2 rounded text-xs overflow-auto" x-text="answer.submittedAnswer"></pre>
              <div>
                <p class="font-medium mb-1">Test Case Results:</p>
                <template x-for="tc in answer.testCases" :key="tc.id">
                  <div class="border-l-2 border-blue-300 pl-2 mb-1">
                    <p><strong>Input:</strong> <span x-text="tc.input"></span></p>
                    <p><strong>Expected:</strong> <span x-text="tc.expectedOutput"></span></p>
                    <p><strong>Actual:</strong> <span x-text="tc.actualOutput"></span></p>
                    <p><strong>Status:</strong>
                      <span :class="tc.passed ? 'text-green-600' : 'text-red-600'"
                        x-text="tc.passed ? 'Passed' : 'Failed'"></span>
                    </p>
                    <p><strong>Weight:</strong> <span x-text="tc.earnedWeight"></span></p>
                  </div>
                </template>
              </div>
              <div>
                <p class="font-medium mb-1">Test Case Result:</p>
                <pre class="bg-gray-100 p-2 rounded text-xs overflow-auto" x-text="answer.testCaseResult" x-if="answer.testCaseResult."></pre>
              </div>
            </div>
          </template>

          <p class="text-sm mt-2">âœ… Score: <span x-text="answer.score"></span> |
            <span :class="answer.isCorrect ? 'text-green-600' : 'text-red-600'"
              x-text="answer.isCorrect ? 'Correct' : 'Incorrect'"></span>
          </p>
        </div>
      </template>
    </div>
  </div>
</body>

</html>